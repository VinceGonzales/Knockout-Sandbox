USE [XolartekDb]

DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Xolartek.ORM.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201808232003088_AutomaticMigration'
BEGIN
    CREATE TABLE [dbo].[MaterialCosts] (
        [Id] [int] NOT NULL IDENTITY,
        [Cost] [int] NOT NULL,
        [MaterialId] [int] NOT NULL,
        [SchematicId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.MaterialCosts] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Materials] (
        [Id] [int] NOT NULL IDENTITY,
        [Description] [nvarchar](max) NOT NULL,
        [PictureId] [int],
        CONSTRAINT [PK_dbo.Materials] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Pictures] (
        [Id] [int] NOT NULL IDENTITY,
        [Source] [nvarchar](max) NOT NULL,
        [CSSClass] [nvarchar](max),
        [Alternate] [nvarchar](max),
        CONSTRAINT [PK_dbo.Pictures] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Schematics] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](100),
        [Description] [nvarchar](max),
        [Durability] [int] NOT NULL,
        [Level] [int] NOT NULL,
        [Stars] [int] NOT NULL,
        [Damage] [int] NOT NULL,
        [CritChance] [decimal](18, 2) NOT NULL,
        [CritDamage] [decimal](18, 2) NOT NULL,
        [AttackRate] [decimal](18, 2) NOT NULL,
        [DurabilityPerUse] [decimal](18, 2) NOT NULL,
        [Impact] [int] NOT NULL,
        [ReloadTime] [decimal](18, 2) NOT NULL,
        [MagazineSize] [int] NOT NULL,
        [Range] [int] NOT NULL,
        [AmmoCost] [int] NOT NULL,
        [RarityId] [int] NOT NULL,
        [PictureId] [int],
        [WeaponEditionId] [int],
        [WeaponTypeId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Schematics] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Rarities] (
        [Id] [int] NOT NULL IDENTITY,
        [Description] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_dbo.Rarities] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[TraitImpacts] (
        [Id] [int] NOT NULL IDENTITY,
        [Impact] [nvarchar](max) NOT NULL,
        [WeaponClass] [int] NOT NULL,
        [TraitId] [int] NOT NULL,
        [SchematicId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.TraitImpacts] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Traits] (
        [Id] [int] NOT NULL IDENTITY,
        [Description] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_dbo.Traits] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[WeaponEditions] (
        [Id] [int] NOT NULL IDENTITY,
        [Description] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_dbo.WeaponEditions] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[WeaponTypes] (
        [Id] [int] NOT NULL IDENTITY,
        [Description] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_dbo.WeaponTypes] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_MaterialId] ON [dbo].[MaterialCosts]([MaterialId])
    CREATE INDEX [IX_SchematicId] ON [dbo].[MaterialCosts]([SchematicId])
    CREATE INDEX [IX_PictureId] ON [dbo].[Materials]([PictureId])
    CREATE INDEX [IX_RarityId] ON [dbo].[Schematics]([RarityId])
    CREATE INDEX [IX_PictureId] ON [dbo].[Schematics]([PictureId])
    CREATE INDEX [IX_WeaponEditionId] ON [dbo].[Schematics]([WeaponEditionId])
    CREATE INDEX [IX_WeaponTypeId] ON [dbo].[Schematics]([WeaponTypeId])
    CREATE INDEX [IX_TraitId] ON [dbo].[TraitImpacts]([TraitId])
    CREATE INDEX [IX_SchematicId] ON [dbo].[TraitImpacts]([SchematicId])
    ALTER TABLE [dbo].[MaterialCosts] ADD CONSTRAINT [FK_dbo.MaterialCosts_dbo.Materials_MaterialId] FOREIGN KEY ([MaterialId]) REFERENCES [dbo].[Materials] ([Id])
    ALTER TABLE [dbo].[MaterialCosts] ADD CONSTRAINT [FK_dbo.MaterialCosts_dbo.Schematics_SchematicId] FOREIGN KEY ([SchematicId]) REFERENCES [dbo].[Schematics] ([Id])
    ALTER TABLE [dbo].[Materials] ADD CONSTRAINT [FK_dbo.Materials_dbo.Pictures_PictureId] FOREIGN KEY ([PictureId]) REFERENCES [dbo].[Pictures] ([Id])
    ALTER TABLE [dbo].[Schematics] ADD CONSTRAINT [FK_dbo.Schematics_dbo.Pictures_PictureId] FOREIGN KEY ([PictureId]) REFERENCES [dbo].[Pictures] ([Id])
    ALTER TABLE [dbo].[Schematics] ADD CONSTRAINT [FK_dbo.Schematics_dbo.Rarities_RarityId] FOREIGN KEY ([RarityId]) REFERENCES [dbo].[Rarities] ([Id])
    ALTER TABLE [dbo].[Schematics] ADD CONSTRAINT [FK_dbo.Schematics_dbo.WeaponEditions_WeaponEditionId] FOREIGN KEY ([WeaponEditionId]) REFERENCES [dbo].[WeaponEditions] ([Id])
    ALTER TABLE [dbo].[Schematics] ADD CONSTRAINT [FK_dbo.Schematics_dbo.WeaponTypes_WeaponTypeId] FOREIGN KEY ([WeaponTypeId]) REFERENCES [dbo].[WeaponTypes] ([Id])
    ALTER TABLE [dbo].[TraitImpacts] ADD CONSTRAINT [FK_dbo.TraitImpacts_dbo.Traits_TraitId] FOREIGN KEY ([TraitId]) REFERENCES [dbo].[Traits] ([Id])
    ALTER TABLE [dbo].[TraitImpacts] ADD CONSTRAINT [FK_dbo.TraitImpacts_dbo.Schematics_SchematicId] FOREIGN KEY ([SchematicId]) REFERENCES [dbo].[Schematics] ([Id])
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201808232003088_AutomaticMigration', N'Xolartek.ORM.Migrations.Configuration',  0x1F8B0800000000000400ED5D5B4FE438167E5F69FF4394A7DD154341F7CB2C2A66C416B042DB348882997943263145D4B9D4262E04339A5FB60FFB93F62F8C73737C8F9DA412604B2DA126B1CF393EFE7C39C7CEC7FFFEF3DFF98F2F51E83CC3340B92F8D83DDC3F701D187B891FC4AB6377831EBFFBDEFDF1873FFF697EE6472FCE4F75B9CF79395C33CE8EDD2784D647B359E63DC10864FB51E0A549963CA27D2F8966C04F669F0E0EFE3E3B3C9C412CC2C5B21C677EB3895110C1E217FCEB22893DB8461B105E263E0CB3EA397EB32CA43A5F4104B335F0E0B1FB4B128214C16FFB573797AE73120600DBB084E1A3EB80384E1040D8C2A3BB0C2E519AC4ABE51A3F00E1EDEB1AE2728F20CC6065F95153DCB411079FF246CC9A8AB5286F93A124B21478F8B9F2CA8CAFDEC9B72EF11AF6DB19F62F7ACD5B5DF8EED8BD0408A6D8118B2443AEC32B3C5A84695E9872EF2249E1FE7992A23840709FAEBEE73085F6082C307AF27F7BCE6213A24D0A8F63B8412908F79CEBCD431878FF82AFB7C937181FC79B30A4CDC506E377CC03FCE83A4DD63045AF37F0B16AC485EF3A33B6DE8CAF48AA5175CAA65DC4E8F327D7F98A958387101234506E5822DCA07FC218A6B8BDFE3540B8D5712E0316FE14B473BA4AE7EAB5E925D47E6EB75A2FA71C3728F0AC057D05CFC1AAF086C234D7B9816151207B0AD6E5D823F8B8A78192B9CE799A4437494855674BDCDF82740573A725DA62CB64937A16C692F64BAD256F8916C654C96BC14E59199991F35933148D06688FC1B91B982A5DA730F3D2605DCEADA552BC3CE035CE752EC1CB1718AFD053DE052F1806C10BF4EB27952177718097445C09A51B683D16AF032F77BAD05EDB81570DA921475F8DD896D15783DFD4E2AAC57A5B49218995D53BB57D75019965C6438E58603AE2AA0ABB71A6D245FA6BE421B6582E1721C8B20134EB159D84B943B06F06D6648C596A61B35E2748DD1D8055BAF29F9AAE3D3C38180044C3AE462DBA36297808C2A2E97D36945FE0330C7BEE491148B37E224E410456B09F8C451AA0C513889B79EA147A4194EFBCAE53FCBF2A12FEDE75961EC8A57653C19A3AB88A138480F7ED869A890657D140E71AA677D9F6145D4438B4EF1938E19D4602FCDB20DA9E999760057E0D62B80C7EED09C11B10F745F1491425FDC3CD1B8091FADA37D834DCE072B57E86609DC4677E90CF839DEAE615868F6FE55BEC0E2123BF79D5859543ECAC1BF992ADB5F052639E6E73AD33AE4493D4B6F2D53DD1C1384F782944DB6209DB84C06D0A0245F4D434BC2E24735BF94EE3B5AA80ADD3986120B58F29A170A1AA8CE04965415B873643506374FE5A6B315740612E5FAA57A2A546A9F5F6B9ACB8DB3BAB748D9B64694FFDC947BBE54CC48F77F55CD5098CC5A451EF7FAC1149D5DEC152A98BD95D8E979328A72E262DD16D7B55F6F2DB3B1030CDB11BACAAEAEC3AB7EC5A2DF752BB8A37F7D4C8612C13DF0AB6498AF45A8F2A53BB0DFEDDB057E97A23AB110BB421F0C8AF481AC876C223B721B5C625537F87CF378ECF96DD52AFD883476A6B90D203AF6520D211AC79911D523F0252AD034E39465561A909404FB22CF182C23C2EB3C41DCFB2ED3E8B7DC7ECACB6EC01FA2C157704C666B0C668C4061DBB8782575BA5935D8E28BD4C33B21AFE2668C07886690EA8BC429CE11112C448047F107BC11A84464DE56A1B0E9EBC67881EFECD295CC338C7BD91374C0CA06FEC8886107DDCF86EF3D67C46C1C8105D75D6AFB5E7850C603BA2C4FED6C8956089642459B107FBFB2256FB218933624C0C717E35514DA5CE27018F2CADADEA676D8EBBE96A2A2C349F95B457AE469D9234AD1C014B1A3F986867A2FC8901D5361D694E240CC0A49B90D4271963CE484A2B4685D13B9C93C40CADAAA335E9DAA6A3EB7CBFF964A4398FEA84CC4EF051B66D04F8281D60A2BB39539E043D927C8AAA9F75C995A6A3ABFC9C397C7439444E6C9D9BDE0A82D4CD1B01426A2798282729EF89D7B02A75DDBED0F0A7C3836D87F804F9980052356FD4058C75C0FBD80429B366AAFE6E4FA135FDCEE5670DB62F067A2658E0DADA3C02CADADC616282708D6942C4F1D92F3D0C94A9301E6B656ED57CF66AB9DA3136C414ED1C0D5F0A479883ABBEE73602B2CA9426AE83700D9856661499F15380C003C86459F6BB0C5689F6AC4AF3F2D0C8A52E21927FD1D2E451A561BE8033B9309DA0562155CC23934102C5161174D659104221BD454CB17D0EA496D4914C8B04F62C5190C2EC1B4C442985B45667E64699186E2D331257C04C29AB9CAB384114D845DCF01F4D5185F59F57F1A3D138834FDAC5805718DDC6397B89BCAA2DFCB112EB081B279151A0718F34E3639682EEEE123EC543496A06756F3F48AFFF8AAE684DA71A2754A966D0138BC623BA14EA161122B975ACF34B3B46D479C13E3E19072692CB85A2335AF25B86192EAA01CD92A171853AA965E4D60ECE90DD6C11BDD196AF31CDD850ADA8572D8D3734391A5E10B17DC0A1525BA81B29B2DC8359F6A1CF38E1F20DDB7386FA6689E814B378DA2EA2A65AC66F53348E6A0DA0B7359814D71B54BED2468216B1A0E0A56AF7D5EA2255F4D7D73FF5AD0B12A29077F35929B07A309F295865E69760BD0EE215C532533D719625C5CCE2BBA53D034B54CA98B1CEE6032AA20925295841EE6DCE20E2C3F320CD50136D2DFC4828C606648A5D73AD4B167389DD57EFA6EB5AF9FFA9E8AF62DC6143333184AD6A9FE3C645791C5C5C3D52EC3EC4EA4E4EF803B036C96DA745126EA2581D96AB6B9751245D5F1657EA24D0773C6839BABB1F6A694C7E9216A74D5CE688E6BC2BA403845EE446150F0D2BE00C009A1E80190B2CCC65375A0CF3C25C1E75984A4BD39CB14ED6D1641FDCB99F159B7B836E56D6DC4E2FD7CB1B33FAA49F18E8A434AC13CCE4429E9A4BA268256851D4E3378312EDA6C210274D36CC1E299ABADBC14AFE93AD5F3E996E4EA1391D1871D473736915B3032DA87A64319E4A6A076638958F2C5A551126302DAA9E598C498ADD811995D4733B6932BBE8E716A39CE26C608639F5BC0B0A6A7A063916EAB7E692EBE4303366A409639D149A918196443FB7D982D1E40BEC268C7E63615F49C2C098563EB2E851C2C2C0F427796A634D7D6B8635487597462DA9CB8E43254B38DCA425B69E7CB6C9ADCFB544A1AA13AFC9563D9262EBBCE6558737F60B9EAAE2DBDAFF4ED42F2D7943C3BEA18FC4EC3B485B7B3BBD34CC0CCD7CA12C0E42EB5D2CB9B545CB525EE552CB796701B232516B83BEAEB8DBCD0BD23EE152BA9DFB863DA0B6EFA396FABBBE826C62B9674715A7FF5D7B495EF9FFA88B84DC3A5F84682739762E973EAFF2DAED34EE42A2BB2C92B3B525CF819F27B997AF1982D17E5E607FF9EF701106B8BD4D814B10078F3043E5C7B7EEA783C34F1C1FFCDBE1669F65991F4ACE05A8CF98D599F131BE220E72CFB67E276C4B8348F1D3150A7A93A1175284EB6717B10F5F8EDDDF8A6A47CEC52FF74DCD3DE72AC56039720E9CDF87204D31B580AA6A61C2106CE1C496DF3F088C24DF9FC7CF20F59E40FA9708BCFCB53F5FA169A7928AAA2EED41EC2BFF5CEEBDF6197B97B85F77F1E4CE4A699D089C2DA40D42D2FCE18667990D679D299226DBF592CD90EFC682DC653D623890BB08601890BB08604985BB4810D98FFDEDB31F0FAE42643F1E5C858AFD7870452C3F5D973E15B98F073752C67DDCC9549AF9B88B009EF7B89B112CEBB1E9F25FD7EBB5A71C73F3216A57902E9BDAC055EF6F499DE8EF624659771BBB6B2545EC875BBC7BEEAD3BF19C7E0CCFB1D376BF1DAE842AB4CBBCC611859A8EA6AADA078D9455F49ABBA1DCD1A16DFC903BC7F6726CF901DBCEAB1DBD3A18FBDE60447BF46E756C5EBD31E9CF1437C2DF33631EF9A24DF639B015F18215AA060281FA36EED630F02EF8A53A71DEF5E77499723ED05DB89D7E42989EB0C59CB56EB829C1125AEF6F52B003DDD4B3822DEB5C4F8EB9697A5F790971E2CE7F679C7103F0C3717F95644446B8D1D8DF94172ADF3FDF5BFFDDC0742018752F600B84E9B702FDB8DB06636A9B667D68BBEE38F132F1BEB9D60660569B12158ABB956F0212AAEF4546634813BFDBE7BB50CD80D64A80567AE4D8F51F12DCEF654A4C4FE3A352A7A548D3A969574182204103792353A024DFE1E55320173450EF643A344413BC967A232FA8A85FC8E4ABF87774CC6C6DC46C323D5A0616A92E35739B527EBB646E59133470EF659AF48C2B1AE2B716DE37B5AEF27A39AF682A623829239764FA52658F24B5A55C899313BE71B302F3ADBF49738D1CF5E6F8DCE434376FA27F07A76BEBDAC396CE7A3B646C22F59AE473FB511BBA2DA23591FE4BDB50C9EA267C1F392480872551EB3066C769F09844696A5AB489213E02FD9982EC6CA4865BF09A89DF58E17066836B47E549388EA8B260D58898639931F498408694B9881F933AAAE22CAA8BF0574121023E8E724E52143C6288E3D71ECCB2E2EF01FE04C20D2E72163D40FF22BEDAA0F506E126C3E8216426C93C2ED3E92FC8DB589BE757C55D816C8826603303DC047815FF6313843EB1FB5C72CF4021220FF8AADB10795FA2FC56C4EA9548FA9AC486822AF79138F51646EB100BCBAEE22578865D6CBBCBE017B802DE6BFDA99C5A487B47B06E9F9F0660958228AB6434F5F1AF18C37EF4F2C31FD6518EA457960000 , N'6.2.0-61023')
END
