USE [XolartekDb]

DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Xolartek.ORM.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201808241525188_AutomaticMigration'
BEGIN
    CREATE TABLE [dbo].[Heroes] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](100) NOT NULL,
        [ImgUrl] [nvarchar](max),
        [Stars] [int] NOT NULL,
        [Level] [int] NOT NULL,
        [Description] [nvarchar](max),
        [RarityId] [int] NOT NULL,
        [DateCreated] [datetime] NOT NULL,
        [TimeStamp] rowversion NOT NULL,
        CONSTRAINT [PK_dbo.Heroes] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Rarities] (
        [Id] [int] NOT NULL IDENTITY,
        [Description] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_dbo.Rarities] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Schematics] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](100),
        [Description] [nvarchar](max),
        [Durability] [int] NOT NULL,
        [Level] [int] NOT NULL,
        [Stars] [int] NOT NULL,
        [Damage] [int] NOT NULL,
        [CritChance] [decimal](18, 2) NOT NULL,
        [CritDamage] [decimal](18, 2) NOT NULL,
        [AttackRate] [decimal](18, 2) NOT NULL,
        [DurabilityPerUse] [decimal](18, 2) NOT NULL,
        [Impact] [int] NOT NULL,
        [ReloadTime] [decimal](18, 2) NOT NULL,
        [MagazineSize] [int] NOT NULL,
        [Range] [int] NOT NULL,
        [AmmoCost] [int] NOT NULL,
        [RarityId] [int] NOT NULL,
        [PictureId] [int],
        [WeaponEditionId] [int],
        [WeaponTypeId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Schematics] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[MaterialCosts] (
        [Id] [int] NOT NULL IDENTITY,
        [Cost] [int] NOT NULL,
        [MaterialId] [int] NOT NULL,
        [SchematicId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.MaterialCosts] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Materials] (
        [Id] [int] NOT NULL IDENTITY,
        [Description] [nvarchar](max) NOT NULL,
        [PictureId] [int],
        CONSTRAINT [PK_dbo.Materials] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Pictures] (
        [Id] [int] NOT NULL IDENTITY,
        [Source] [nvarchar](max) NOT NULL,
        [CSSClass] [nvarchar](max),
        [Alternate] [nvarchar](max),
        CONSTRAINT [PK_dbo.Pictures] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[TraitImpacts] (
        [Id] [int] NOT NULL IDENTITY,
        [Impact] [nvarchar](max) NOT NULL,
        [WeaponClass] [int] NOT NULL,
        [TraitId] [int] NOT NULL,
        [SchematicId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.TraitImpacts] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Traits] (
        [Id] [int] NOT NULL IDENTITY,
        [Description] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_dbo.Traits] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[WeaponEditions] (
        [Id] [int] NOT NULL IDENTITY,
        [Description] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_dbo.WeaponEditions] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[WeaponTypes] (
        [Id] [int] NOT NULL IDENTITY,
        [Description] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_dbo.WeaponTypes] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_RarityId] ON [dbo].[Heroes]([RarityId])
    CREATE INDEX [IX_RarityId] ON [dbo].[Schematics]([RarityId])
    CREATE INDEX [IX_PictureId] ON [dbo].[Schematics]([PictureId])
    CREATE INDEX [IX_WeaponEditionId] ON [dbo].[Schematics]([WeaponEditionId])
    CREATE INDEX [IX_WeaponTypeId] ON [dbo].[Schematics]([WeaponTypeId])
    CREATE INDEX [IX_MaterialId] ON [dbo].[MaterialCosts]([MaterialId])
    CREATE INDEX [IX_SchematicId] ON [dbo].[MaterialCosts]([SchematicId])
    CREATE INDEX [IX_PictureId] ON [dbo].[Materials]([PictureId])
    CREATE INDEX [IX_TraitId] ON [dbo].[TraitImpacts]([TraitId])
    CREATE INDEX [IX_SchematicId] ON [dbo].[TraitImpacts]([SchematicId])
    ALTER TABLE [dbo].[Heroes] ADD CONSTRAINT [FK_dbo.Heroes_dbo.Rarities_RarityId] FOREIGN KEY ([RarityId]) REFERENCES [dbo].[Rarities] ([Id])
    ALTER TABLE [dbo].[Schematics] ADD CONSTRAINT [FK_dbo.Schematics_dbo.Pictures_PictureId] FOREIGN KEY ([PictureId]) REFERENCES [dbo].[Pictures] ([Id])
    ALTER TABLE [dbo].[Schematics] ADD CONSTRAINT [FK_dbo.Schematics_dbo.WeaponEditions_WeaponEditionId] FOREIGN KEY ([WeaponEditionId]) REFERENCES [dbo].[WeaponEditions] ([Id])
    ALTER TABLE [dbo].[Schematics] ADD CONSTRAINT [FK_dbo.Schematics_dbo.WeaponTypes_WeaponTypeId] FOREIGN KEY ([WeaponTypeId]) REFERENCES [dbo].[WeaponTypes] ([Id])
    ALTER TABLE [dbo].[Schematics] ADD CONSTRAINT [FK_dbo.Schematics_dbo.Rarities_RarityId] FOREIGN KEY ([RarityId]) REFERENCES [dbo].[Rarities] ([Id])
    ALTER TABLE [dbo].[MaterialCosts] ADD CONSTRAINT [FK_dbo.MaterialCosts_dbo.Materials_MaterialId] FOREIGN KEY ([MaterialId]) REFERENCES [dbo].[Materials] ([Id])
    ALTER TABLE [dbo].[MaterialCosts] ADD CONSTRAINT [FK_dbo.MaterialCosts_dbo.Schematics_SchematicId] FOREIGN KEY ([SchematicId]) REFERENCES [dbo].[Schematics] ([Id])
    ALTER TABLE [dbo].[Materials] ADD CONSTRAINT [FK_dbo.Materials_dbo.Pictures_PictureId] FOREIGN KEY ([PictureId]) REFERENCES [dbo].[Pictures] ([Id])
    ALTER TABLE [dbo].[TraitImpacts] ADD CONSTRAINT [FK_dbo.TraitImpacts_dbo.Traits_TraitId] FOREIGN KEY ([TraitId]) REFERENCES [dbo].[Traits] ([Id])
    ALTER TABLE [dbo].[TraitImpacts] ADD CONSTRAINT [FK_dbo.TraitImpacts_dbo.Schematics_SchematicId] FOREIGN KEY ([SchematicId]) REFERENCES [dbo].[Schematics] ([Id])
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201808241525188_AutomaticMigration', N'Xolartek.ORM.Migrations.Configuration',  0x1F8B0800000000000400ED5D5B6FE3B8157E2FD0FF20F8A92DB27632F3B20D9C5D649DA40D3A990471B2DDB780911847185D5C894E932DFACBFAD09FD4BF50EACEFB459225276B0C308825F29CC3C38FB743EAE3FFFEF3DFF98FAF61E0BCC024F5E3E86472343D9C38307263CF8F5627930D7AFAEEFBC98F3FFCFE77F3732F7C757EAED27DCED2E19C517A327946687D3C9BA5EE330C413A0D7D3789D3F8094DDD389C012F9E7D3A3CFCF3ECE86806B1880996E538F3DB4D84FC10E63FF0CF451CB9708D3620B88A3D18A4E573FC66994B75BE8210A66BE0C293C92F71001204BF4DAF6FAF26CE69E0036CC312064F130744518C00C2161EDFA7708992385A2DD7F80108EEDED610A77B02410A4BCB8F9BE4A68538FC941562D664AC44B99B14C5A1A5C0A3CFA557666CF656BE9DD45EC37E3BC7FE456F59A973DF9D4CFE0A9378E2B08A8E1741922522DCBA881338BD881314F9084EB36C070EF5F2A08601464BF6EFC0596C02B449E04904372801C18173B3790C7CF76FF0ED2EFE06A393681304A479D840FC8E7A801FDD24F11A26E8ED163E95465F7A136746E79BB119EB6C449EA2489711FAFC69E27CC5CAC16300EBDA278ABF44B8407F81114C0082DE0D400826512603E6FEE3B433BAB2FF2B6D186EB8CD4C9C2BF0FA05462BF48C5BD3216E2517FE2BF4AA27A505F7918F9B18CE84920D1458A8D67A19AEEE9340A117FF69A457AD66894092EA7CA916F105BEC0A09B883398BA89BF2E5AC5964B7C0B125CE97A00692CC6505A2430035425287B74E787A2AAD683711187EB4D2E4CAD375380EB2C5C575A7FF22390600C67BDEB264970B7FE7695FB227714E5BFEFC5DEEBD3DAAFE0C55FE559855E9F38B730C85FA7CFFEBAE8D1A7C5AB87AC1382188A17491CDEC6419DA77CF17007921544B8D8B1E8ED32DE242E536BF359D3412ABBCDCA38EB8EB3C8B8EF3A8769D7BA262A055F05ADF6E0ABE025065F054D537B8AF90EF25DA54D642ACEAEE6A5CC362285C83EE3C651CB69D13EEABCFB2622D3D5D3EC6277C6D7B34D021EFD202FFAC8D38A1E26376720042BD84DC602B7C7C53388DC5ACE1974FD10E0D2DD24F8AF72558687E7A50B32A9ED54D0A6F6AEE21421E07EBBC520DF9A8A063A3730B94FB7A7E832C4CB4CD4AD5671C71D03AF98F06DC9CC2BB002BFFA115CFABF7684E02D88BAA2F8340CE3459C76F55A2FB3EF1BDFCD060B4E8C3AD7DF2158C7D1B9E767FD60ABBC59066BDBA5D3802BDC96121FE711CE02EAB1F38148D7CC0304AFB99980288DED5CA574B5C6C43A95C8C0F2A5C2BC2A85AD71FA5585E9244AB2BA104CB34C6DBB4B808F74555B2512B9AD78A7F05A99C0D669543310DA47A590B8509686F3A434A1AD439B26A8303A7BADB498492031974DD569795935BEA2F7B49E4493D9F7F36899AEEE4353E5E7AE83530D9BFE470A21F0AB970F245028E48B5370D09724B36DA7C482B19F618DB55335F4756AA01D1AE7BE61CA740D1B036A3751D436BCB249F5D9FAD8715DD348FB98AFD52A04D335F69DDC3ED564CDB8C9D51698B6B832C3BE9DC974D5F53570135B2C978B00A4690F9A350BD0207308117FE849933166F3F976153AB01E2988DC7B104B75518199E1405CCCFA291CB79BFC15B5BC7B3348D34999C182543E1D6356AC562B65A15DF99B07A2E55096F16F39DB04493ACD144B53DB35FE7DB397E9DA917D421A687DE0919D442920DB0A8F4C2CC71A9754FE3D3E771C9F9A7DE34E613B16A9DAF85E07BC1631BC9660CD92EC91FA11906A1DAB15635416D13501E8699AC6AE9F9B476D29540742E8E29E479EA33C1D52F8BBD97EC04EC738F4D71879F8D7C9E488F3A04C643D91694416873B69817FE20462A8C224C34A164088520C7E3F423CAEFDC8F5D720501587C964D81C325FD7E2D93767700DA30CC9AA329BE86DB61179EDB512A699EA3C339F116850834412F49155AD2E02D4D471138934078E2EBACB4B2F62E55B4192BAA803404AED0D1303C87D8071D15505C9B435CFC5ECF488E2EB5B215780A53A80478B3D9C4E79AC76431263C4901862FC6AA29A88388F021ED1FE8AAC9E9567089AAA266207E6BD92722367D02E4951CA01B0A4F08389762A143432A074DD91E2C4870198541D92FCA4C8903D92D48A4161F40EFB2441D84456D3AA184A53D56518CEBC3752850A19B155087A2B7D91BC78036048EE0413E575647BE45EA88C50EBBB0AF6FC546F031A1B071F1240B2E20DDA05D10E781FC398343826AB6F7DA4ACA977260C6B300019E811E0CB62F06C852E5D99074099CE1D262670077D47441C1BE452C3401AF162B1568450CD7B2FCDE1C7A1212629E760F89238C21C5CD549F05190C59F6DD60415D5886A1DAB1C1749D2B20D17B86C87A041839745DC1BE74138074C4A13F2ED933380C02348455B31F7292C7763D2722F80854226750911F385651365A782D61C90E8DCB9437C61FE0A9B1A09E42E02278300A2460C73868F9344472B0C85A9046985944B37918C7ABDAB11416F577362A839AB8928A9106D766A5C168961E65146E272904A6515E3242388682A0C089B2F818934C24F85D996ABDB1BAA8D27E1CEB57FDD761021A53294DD8DA40B675070D90956DE0326DB1E361B1F446988C6A2708A66AB4320AF2C4B7F4EAA5B9DC23DC2409959E4BEBD4BD8C81821A9E9443AFB41787C9F7785360A6D1C87268A4176F20A8FA822CF5B4488E06338955FF418918753BBF8641898880E4AF1DED0C5054D23834419AA114AE10B452C901554DBDE233A2A0B55E010C5B8CCA25C5DA0C1C4B5B6E70CF94125DE2966711BBBC80D5132764AA27094365063E4FBD6EEE24ECBC87CA58C3858C41C382F95332DAD8B6451866DF947F0A9AF74F666E417F9AAB9E52C6E0BCEA84E34D52BBBFADD7C56082C1FCC6712E2BDF91558AFFD684510F1954F9C65C1C2B7F86E694F5217163266B487D97568AD09C5095841E66DF639A7072FFC2445CD2275E1855C327A1D2B592E54BAA8A52A5F67D5FAA14A9EFD4DAC964B36C26245CB2FF3CB5C17B834611627C8CFF131D3753E9B93911F022C5D70647011079B3092872BE4B90B4E19327FF1C45C42C53E47D9503E339752F2AF9042CA47E6324A1A185246F9C85C067528929444BD3097D704704861F2B08EC23292468EB28C7C612E8FA08723A5118F7959F319835D2E28C5B50DA693625B9A513BACFBCFD62DB18C0DD9B74559C6EDB4C6B6E81BA95E9423A461CD341137FBCA51E4DDD5DEB2EFFE85A4D0A2C411CF87ED41FBE8C92B7E2ABA9B2B9E994B21C9B44849E4733B6922BBC8E7E6D2488A2C521AF9BC0D0A2A362C3116AAB736A37B11EDA54777510458258524C0A2C641E2B9B9349AEB8A9447BFB119A523B65ACB4716355A935E51F5593F1D63CE409CE62245290E79C965713BE5A444ED36BA4E6EB549CA0B956D9F8E36EAE922DA86031FB541643FF6A9B36F67F8E3E16D0B6DF2C03CDD70E507E9E5D2A8A342D480A33A43343A707A004D07C0ECFA5CB6CFBE6CA48AAEA3E3ADEB5912F237A86669CEEDD47215EDA25A9FF0A37E9594861884EA5CEAA716A370C3FC410DC3CDE39D41896633C31029E49EBC3D5A94B9B783987E6694140B073F69B0C64D7D64998A85C8CE31CBE5BCB32149BA7B6483BEB6B8DBF59168A43A61F6995AD70D7D42C6BE8E34F9F77505E9DDAE8E15951F3F6A5B4BE2CCBFA12AE2F6B8D824B5F67AAF8BD9D39A97FB4BFA1BA7B80DA7224946E61DBFF85EB6D9B47C4B110CA75982E9F21FC122F071799B045720F29F608A0A8289C9A7C3A34FCCD555BB738DD42C4DBD40B03F47507548EE92BA8C3CF87A32F997F3EFE1E933FCCCDD5A820C4BB2AD22D85B28885E40E23E8384BF82A1D3ED4D95D83F84E0F58FA42CEB1B9A720F74B948A18D0001A748A712B11CF0B94D72A065998E9DCB5F1EAA7C07CE7582DBDBB1738841D8C3C54D1EFE81F270A5F6BA235B3638F6B6A624FE67790D5F5765DD2F37FA702DD906A75D3CAABA11E7C339D5B67B6C791D4DA70E85BF7266947EB2734F4DDFE0D246027FD58CB7FDAB667A57C15F35D3BB0AD95533BD2BA2194DDBD4297FD14CEF468A2E9A69652A79CD4C1B01EC2533ED8C18717AC1118E9B6AAF33CAD49B7484921B6E4C6D60B277B7A4DAE66B634691D7A232DADDC7F13146E9AE6D86DCAAB3ABAC2667A77623A03C36B580C8BA4DB4FC16267B1D67D0E376873DDC3DF0E12A94FEDABB5B5DB244FF9DA6EC1C99BF85B45684FD1FA33EE9D964B7FA1470DEB7193A18C67BD3065E66FBA083868C27FEC3753043C55C7444E77BC776726CF199FCDEAB2DBDDA8D46BA23194BB1514388D83A51F4100C2B92CFAC466653E98D0ABA37D66772E53734C9F3905CBC9213B5BC3ED5A9D3DDA26FAED7212252172B0E392B54F50402F969C6AD61E05D909DB62260EE4E4F39667FA0FADC6BFC0E617CEE49730AE5FEBA044B68BDBF4EC10E7463F70AB614C83DD01D3377E90D48703C1899B1F48834AFEEBDD117771F11C603C1A0E3812D10C61F0EBA5111F7463C3CCE08A13BC03CF238F1BEA9837B200A1E131592D3D23B0109D917AB3B49F8DB31A2340E06868B2DD9D5FF0ED0F5F26C486CD5F174BC5232DEA2F42713EF310B1B16B14E0999282BB7821227B97A21922D23CA9293F8AA397C453A14145AAC167A3DCC29A25F8B74A9892365EA9424C02A357A15F50291D350BF112990D23DB2F2A90923A7837A2BD2A3240F14EA92130C4BE5EB253353254E03F35EA4494D16A8E027D6D013CB75151F21B18A86E02FE6B9EE04A433DC2E049147C8FCBD93ECC4425A586561457D084FE0D063E1FB611D663A0AEAD37293E21A396AE74885C55C8B3B51BFBD7306B7AD614B67ED102330CF53AB2CA8602CE3BE99EFB35EFB65FB6D01E5610A3C24A3AF9CBF7764880FC0D32B61E51DB9E05B22E0B59D82F457500B725DFE0363BCFADB44D9F784C5AF3398FAAB46C41CCB8CA04BADFBEA3497D1535C2D40198BAA24ECC16D8880871785A709F29F705BC6AF5D98A6F985EF3F836083939C878FD0BB8CAE3768BD41B8C8307C0C284766CB5895FE9C4198B6797E9D9FA149FB280236D3CF3EC1BC8E7EDAF88157DB7D21387F231191AD8FCB5342595DA2ECB4D0EAAD96F4358E0C0595EEAB97F577305C0758587A1D2DC10B6C63DB7D0ABFC01570DFAAEFC4E542F41541BB7D7EE6835502C2B494D1E4C73F3186BDF0F587FF03A0CEFE43FFA90000 , N'6.2.0-61023')
END
